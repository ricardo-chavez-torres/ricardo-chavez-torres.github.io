---
import LeftSidenote from "./LeftSidenote.astro";

import type { MarkdownHeading } from "astro";

interface SimpleHeading {
  text: string;
  slug: string;
  depth: number;
  sub: Array<{ text: string; slug: string }>;
}

const { headings } = Astro.props as { headings: MarkdownHeading[] };

// Build a very small nested structure (h2 -> h3).
const toc: SimpleHeading[] = [];
for (const h of headings || []) {
  if (h.depth === 2) {
    toc.push({ text: h.text, slug: h.slug, depth: 2, sub: [] });
  } else if (h.depth === 3) {
    const last = toc[toc.length - 1];
    if (last) last.sub.push({ text: h.text, slug: h.slug });
    else toc.push({ text: h.text, slug: h.slug, depth: 3, sub: [] });
  }
}
---

<LeftSidenote>
  <nav aria-label="Table of contents">
    <h2>Contents</h2>
    <ul>
      {toc.map((h) => (
        <li>
          <a href={'#' + h.slug}>{h.text}</a>
          {h.sub.length > 0 && (
            <ul>
              {h.sub.map((s) => (
                <li>
                  <a href={'#' + s.slug}>{s.text}</a>
                </li>
              ))}
            </ul>
          )}
        </li>
      ))}
    </ul>
  </nav>
</LeftSidenote>