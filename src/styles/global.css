@import 'tailwindcss';

@plugin '@tailwindcss/typography';

@custom-variant dark (&:is(.dark *));

@theme {
  --font-sans: Geist Sans, ui-sans-serif, system-ui, sans-serif,
    'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  --font-mono: Geist Mono, ui-monospace, SFMono-Regular, Menlo, Monaco,
    Consolas, 'Liberation Mono', 'Courier New', monospace;
}

/*
  The default border color has changed to `currentColor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentColor);
  }
}

@import 'katex/dist/katex.min.css';
/* @import 'https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css'; */

@layer utilities {
  html {
    overflow-y: auto;
    color-scheme: light;
    scroll-padding-top: 100px;
    font-size: 17px;
  }

  html.dark {
    color-scheme: dark;
  }

  html,
  body {
    @apply size-full;
  }

  body {
    @apply font-sans antialiased;
    @apply flex flex-col;
    @apply bg-neutral-100 dark:bg-neutral-900;
    @apply text-black/75 dark:text-white/75;
  }

  header {
    @apply fixed left-0 right-0 top-0 z-50 py-6;
    @apply bg-neutral-100/75 dark:bg-neutral-900/75;
    @apply saturate-200 backdrop-blur-xs;
  }

  main {
    @apply flex-1 py-32;
  }

  footer {
    @apply py-6 text-sm;
  }

  article {
    /* @apply prose prose-neutral max-w-3xl dark:prose-invert prose-img:mx-auto prose-img:my-auto; */
    /* @apply prose prose-neutral max-w-4xl dark:prose-invert prose-img:mx-auto prose-img:my-auto; */
    /* @apply prose prose-neutral max-w-6xl dark:prose-invert prose-img:mx-auto prose-img:my-auto; */
    /* @apply prose prose-neutral max-w-7xl dark:prose-invert prose-img:mx-auto prose-img:my-auto; */
    /* @apply prose prose-neutral max-w-full dark:prose-invert prose-img:mx-auto prose-img:my-auto; */

    @apply prose prose-neutral dark:prose-invert prose-img:mx-auto prose-img:my-auto;
    @apply max-w-3xl;
    @apply prose-headings:font-semibold;
    @apply prose-headings:text-black dark:prose-headings:text-white;
  }

  /* Ensure the article's prose uses the full container width (so the
     article text lines up with the page title which lives outside the
     prose wrapper). Some prose defaults set a narrower max-width; override
     that here so article and title align. */
  article.prose {
    max-width: 100% !important;
    width: 100% !important;
  }
}

@layer utilities {
  article a {
    @apply font-sans text-current underline underline-offset-[3px];
    @apply decoration-black/30 dark:decoration-white/30;
    @apply transition-colors duration-300 ease-in-out;
  }
  article a:hover {
    @apply text-black dark:text-white;
    @apply decoration-black/50 dark:decoration-white/50;
  }
}

.animate {
  @apply -translate-y-3 opacity-0;
  @apply transition-all duration-300 ease-out;
}

.animate.show {
  @apply translate-y-0 opacity-100;
}

html #back-to-top {
  @apply pointer-events-none opacity-0;
}

html.scrolled #back-to-top {
  @apply pointer-events-auto opacity-100;
}

/* shiki config */
pre {
  @apply border border-black/15 py-5 dark:border-white/20;
}

:root {
  --astro-code-foreground: #09090b;
  --astro-code-background: #fafafa;
  --astro-code-token-comment: #a19595;
  --astro-code-token-keyword: #f47067;
  --astro-code-token-string: #00a99a;
  --astro-code-token-function: #429996;
  --astro-code-token-constant: #2b70c5;
  --astro-code-token-parameter: #4e8fdf;
  --astro-code-token-string-expression: #ae42a0;
  --astro-code-token-punctuation: #8996a3;
  --astro-code-token-link: #8d85ff;
}

.dark {
  --astro-code-foreground: #fafafa;
  --astro-code-background: #09090b;
  --astro-code-token-comment: #a19595;
  --astro-code-token-keyword: #f47067;
  --astro-code-token-string: #00a99a;
  --astro-code-token-function: #6eafad;
  --astro-code-token-constant: #b3cceb;
  --astro-code-token-parameter: #4e8fdf;
  --astro-code-token-string-expression: #bf7db6;
  --astro-code-token-punctuation: #8996a3;
  --astro-code-token-link: #8d85ff;
}

/* copy code button on codeblocks */
.copy-code {
  @apply absolute right-3 top-3 grid size-9 place-content-center rounded-sm border border-black/15 bg-neutral-100 text-center duration-300 ease-in-out dark:border-white/20 dark:bg-neutral-900;
}

.copy-code:hover {
  @apply bg-[#E9E9E9] transition-colors dark:bg-[#232323];
}

.copy-code:active {
  @apply scale-90 transition-transform;
}

/* --- Sidenote / Distill Style --- */

/* Hide the real checkbox */
.sidenote-toggle {
  display: none;
}

/* Style the '⊕' toggle */
label.sidenote-toggle {
  display: inline;
  cursor: pointer;
  vertical-align: super;
  font-size: 0.75rem;
  padding: 0 0.25rem;
  color: theme(colors.blue.500);
  user-select: none;
}

.sidenote {
  display: none; /* Hide note by default */
  position: relative;
  background: theme(colors.neutral.100);
  padding: 1rem;
  border-radius: 0.25rem;
  border: 1px solid theme(colors.neutral.300);
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.dark .sidenote {
  background: theme(colors.neutral.800);
  border-color: theme(colors.neutral.700);
}

/* This is the mobile-first "popup" style */
input.sidenote-toggle:checked + .sidenote {
  display: block;
}

/* This is the magic for wide screens (lg: 1024px)
  It pulls the note into the margin.
*/
@media (min-width: 1024px) {
  label.sidenote-toggle {
    display: none; /* Hide the '⊕' on desktop */
  }

  .sidenote {
    display: block;
    position: absolute;
    top: auto; /* Let the browser position it */
    left: 105%; /* Push it just outside the article's 100% width */
    width: 35ch; /* A good, readable width for a note */
    
    /* Reset mobile styles */
    border: none;
    background: none;
    padding: 0;
    margin: 0;
    font-size: 0.875rem; /* Make note text slightly smaller */
    line-height: 1.5;
  }

  .dark .sidenote {
    background: none;
    border: none;
  }
}

/* --- Left-side Sidenote --- */

/* Hide the real checkbox for left sidenote */
.sidenote-left-toggle {
  display: none;
}

/* Style the '⊕' toggle for left sidenote (placed near the text but used to
   reveal the left-side content on small screens) */
label.sidenote-left-toggle {
  display: inline;
  cursor: pointer;
  vertical-align: super;
  font-size: 0.75rem;
  padding: 0 0.25rem;
  color: theme(colors.blue.500);
  user-select: none;
}

.sidenote-left {
  display: none; /* Hide by default on small screens */
  position: relative;
  background: theme(colors.neutral.100);
  padding: 1rem;
  border-radius: 0.25rem;
  border: 1px solid theme(colors.neutral.300);
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.dark .sidenote-left {
  background: theme(colors.neutral.800);
  border-color: theme(colors.neutral.700);
}

/* Mobile-first: reveal when toggled */
input.sidenote-left-toggle:checked + .sidenote-left {
  display: block;
}

/* On wide screens, pull left sidenote into the left margin */
@media (min-width: 1024px) {
  /* Hide the inline toggle label on desktop */
  label.sidenote-left-toggle {
    display: none;
  }

  .sidenote-left {
    display: block;
    position: absolute;
    top: auto;
    /* Push it to the left of the article */
    right: 105%;
    width: 30ch;
    /* Reset mobile styles */
    border: none;
    background: none;
    padding: 0;
    margin: -2.2rem 0 0 -2.5rem;
    /* margin: 0rem 0 0 -2.5rem; */
    font-size: 0.825rem;
    line-height: 1.6;
  }

  .dark .sidenote-left {
    background: none;
    border: none;
  }
}

/* --- Table of Contents Margin --- */

.blog-post-wrapper {
  @apply relative;
}

/* On large screens, position TOC in the left margin (outside the centered container) */
@media (min-width: 1280px) {
  /* Only show TOC on larger screens where there's enough margin space */
  .blog-post-wrapper {
    position: relative;
  }

  /* Position TOC in the left margin using viewport-relative positioning */
  /* Container is centered: max-w-2xl (42rem) with px-3 (0.75rem padding each side) */
  /* Container content area starts at: 50vw - 21rem - 0.75rem */
  /* TOC should be to the left: subtract TOC width (280px = 17.5rem) and gap (2rem) */
  .toc-sidebar {
    /* Position the TOC inside the page flow container so it scrolls with the article
       instead of remaining stuck to the viewport. We set top via script so the
       TOC lines up with the article start. */
    position: absolute;
    /* Use viewport-relative positioning to align with centered container */
    /* Container content starts at: 50vw - 24rem - 0.75rem */
    /* Position TOC to the left with gap */
    left: max(1rem, calc(50vw - 21rem - 0.75rem - 280px - 2rem));
    width: 260px;
    margin-bottom: 0;
    /* top is set by script to align with article start */
    z-index: 10;
  }

  /* Reset nav internal offsets — the TOC aside's `top` will be set via script
     so we keep the nav content flush to the aside's top. */
  .toc-sidebar nav {
    position: relative;
    top: 0;
    padding-top: 11px;
  }

  /* Hide TOC on smaller screens where there's not enough space */
  @media (max-width: 1279px) {
    .toc-sidebar {
      display: none;
    }
  }
}

/* Styling for TOC when placed inside a sidenote (LeftSidenote) */
.sidenote-left nav ul,
.sidenote-left nav ul li {
  margin: 0;
  padding: 0;
  list-style: none !important;
}

.sidenote-left nav ul li::marker {
  content: none;
}

.sidenote-left nav a {
  text-decoration: none;
  border-bottom: none;
  color: inherit;
  /* Slightly smaller line-height to tighten wrapped lines */
  font-size: 0.8rem;
  line-height: 1.0rem;
  display: inline-block;
}

.sidenote-left nav a:hover,
.sidenote-left nav a:focus {
  /* Show underline on hover/focus for better affordance */
  text-decoration: underline;
  text-decoration-color: currentColor;
  text-underline-offset: 2px;
}

/* Slightly reduce vertical gap between list items */
.sidenote-left nav ul li {
  margin-bottom: 0.125rem;
}

/* Make top-level TOC entries bold, nested (subsections) normal weight */
.sidenote-left nav > ul > li > a {
  font-weight: 600;
}

.sidenote-left nav ul ul a {
  font-weight: 400;
}

/* Add indent only to nested lists (subsections) */
.sidenote-left nav ul ul {
  margin-left: 0.875rem; /* same as ml-4-ish */
  margin-top: 0.25rem;
}

/* Ensure top-level list items are not indented */
.sidenote-left nav > ul > li {
  padding-left: 0;
}

/* Container stays at normal max-w-3xl and centered - no changes needed */
/* Article stays centered within the container as normal */